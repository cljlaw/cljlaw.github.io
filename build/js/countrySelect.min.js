!function(n){"function"==typeof define&&define.amd?define(["jquery"],function(i){n(i,window,document)}):n(jQuery,window,document)}(function(n,i,t,a){"use strict";function e(i,t){this.element=i,this.options=n.extend({},o,t),this._defaults=o,this.ns="."+s+r++,this._name=s,this.init()}var s="countrySelect",r=1,o={defaultCountry:"",defaultStyling:"inside",onlyCountries:[],preferredCountries:["us","gb"]},u={UP:38,DOWN:40,ENTER:13,ESC:27,PLUS:43,A:65,Z:90},l=!1;n(i).on("load",function(){l=!0}),e.prototype={init:function(){return this._processCountryData(),this._generateMarkup(),this._setInitialState(),this._initListeners(),this.autoCountryDeferred=new n.Deferred,this._initAutoCountry(),this.autoCountryDeferred},_processCountryData:function(){this._setInstanceCountryData(),this._setPreferredCountries()},_setInstanceCountryData:function(){var i=this;if(this.options.onlyCountries.length){var t=[];n.each(this.options.onlyCountries,function(n,a){var e=i._getCountryData(a,!0);e&&t.push(e)}),this.countries=t}else this.countries=h},_setPreferredCountries:function(){var i=this;this.preferredCountries=[],n.each(this.options.preferredCountries,function(n,t){var a=i._getCountryData(t,!1);a&&i.preferredCountries.push(a)})},_generateMarkup:function(){this.countryInput=n(this.element);var i="country-select";this.options.defaultStyling&&(i+=" "+this.options.defaultStyling),this.countryInput.wrap(n("<div>",{class:i}));var t=n("<div>",{class:"flag-dropdown"}).insertAfter(this.countryInput),a=n("<div>",{class:"selected-flag"}).appendTo(t);this.selectedFlagInner=n("<div>",{class:"flag"}).appendTo(a),n("<div>",{class:"arrow"}).appendTo(this.selectedFlagInner),this.countryList=n("<ul>",{class:"country-list v-hide"}).appendTo(t),this.preferredCountries.length&&(this._appendListItems(this.preferredCountries,"preferred"),n("<li>",{class:"divider"}).appendTo(this.countryList)),this._appendListItems(this.countries,""),this.countryCodeInput=n("#"+this.countryInput.attr("id")+"_code"),this.countryCodeInput||(this.countryCodeInput=n('<input type="hidden" id="'+this.countryInput.attr("id")+'_code" name="'+this.countryInput.attr("name")+'_code" value="" />'),this.countryCodeInput.insertAfter(this.countryInput)),this.dropdownHeight=this.countryList.outerHeight(),this.countryList.removeClass("v-hide").addClass("hide"),this.countryListItems=this.countryList.children(".country")},_appendListItems:function(i,t){var a="";n.each(i,function(n,i){a+='<li class="country '+t+'" data-country-code="'+i.iso2+'">',a+='<div class="flag '+i.iso2+'"></div>',a+='<span class="country-name">'+i.name+"</span>",a+="</li>"}),this.countryList.append(a)},_setInitialState:function(){var n=!1;this.countryInput.val()&&(n=this._updateFlagFromInputVal());var i=this.countryCodeInput.val();if(i&&this.selectCountry(i),!n){var t;this.options.defaultCountry?(t=this._getCountryData(this.options.defaultCountry,!1))||(t=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0]):t=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0],this.defaultCountry=t.iso2}},_initListeners:function(){var n=this;this.countryInput.on("keyup"+this.ns,function(){n._updateFlagFromInputVal()}),this.selectedFlagInner.parent().on("click"+this.ns,function(i){n.countryList.hasClass("hide")&&!n.countryInput.prop("disabled")&&n._showDropdown()}),this.countryInput.on("blur"+this.ns,function(){n.countryInput.val()!=n.getSelectedCountryData().name&&n.setCountry(n.countryInput.val()),n.countryInput.val(n.getSelectedCountryData().name)})},_initAutoCountry:function(){"auto"===this.options.initialCountry?this._loadAutoCountry():(this.selectCountry(this.defaultCountry),this.autoCountryDeferred.resolve())},_loadAutoCountry:function(){n.fn[s].autoCountry?this.handleAutoCountry():n.fn[s].startedLoadingAutoCountry||(n.fn[s].startedLoadingAutoCountry=!0,"function"==typeof this.options.geoIpLookup&&this.options.geoIpLookup(function(i){n.fn[s].autoCountry=i.toLowerCase(),setTimeout(function(){n(".country-select input").countrySelect("handleAutoCountry")})}))},_focus:function(){this.countryInput.focus();var n=this.countryInput[0];if(n.setSelectionRange){var i=this.countryInput.val().length;n.setSelectionRange(i,i)}},_showDropdown:function(){this._setDropdownPosition();var n=this.countryList.children(".active");this._highlightListItem(n),this.countryList.removeClass("hide"),this._scrollTo(n),this._bindDropdownListeners(),this.selectedFlagInner.children(".arrow").addClass("up")},_setDropdownPosition:function(){var t=this.countryInput.offset().top,a=n(i).scrollTop(),e=t+this.countryInput.outerHeight()+this.dropdownHeight<a+n(i).height(),s=t-this.dropdownHeight>a,r=!e&&s?"-"+(this.dropdownHeight-1)+"px":"";this.countryList.css("top",r)},_bindDropdownListeners:function(){var i=this;this.countryList.on("mouseover"+this.ns,".country",function(t){i._highlightListItem(n(this))}),this.countryList.on("click"+this.ns,".country",function(t){i._selectListItem(n(this))});var a=!0;n("html").on("click"+this.ns,function(n){a||i._closeDropdown(),a=!1}),n(t).on("keydown"+this.ns,function(n){n.preventDefault(),n.which==u.UP||n.which==u.DOWN?i._handleUpDownKey(n.which):n.which==u.ENTER?i._handleEnterKey():n.which==u.ESC?i._closeDropdown():n.which>=u.A&&n.which<=u.Z&&i._handleLetterKey(n.which)})},_handleUpDownKey:function(n){var i=this.countryList.children(".highlight").first(),t=n==u.UP?i.prev():i.next();t.length&&(t.hasClass("divider")&&(t=n==u.UP?t.prev():t.next()),this._highlightListItem(t),this._scrollTo(t))},_handleEnterKey:function(){var n=this.countryList.children(".highlight").first();n.length&&this._selectListItem(n)},_handleLetterKey:function(i){var t=String.fromCharCode(i),a=this.countryListItems.filter(function(){return n(this).text().charAt(0)==t&&!n(this).hasClass("preferred")});if(a.length){var e,s=a.filter(".highlight").first();e=s&&s.next()&&s.next().text().charAt(0)==t?s.next():a.first(),this._highlightListItem(e),this._scrollTo(e)}},_updateFlagFromInputVal:function(){var i=this,t=this.countryInput.val().replace(/(?=[() ])/g,"\\");if(t){for(var a=[],e=new RegExp("^"+t,"i"),s=0;s<this.countries.length;s++)this.countries[s].name.match(e)&&a.push(this.countries[s].iso2);var r=!1;return n.each(a,function(n,t){i.selectedFlagInner.hasClass(t)&&(r=!0)}),r||(this._selectFlag(a[0]),this.countryCodeInput.val(a[0]).trigger("change")),!0}return!1},_highlightListItem:function(n){this.countryListItems.removeClass("highlight"),n.addClass("highlight")},_getCountryData:function(n,i){for(var t=i?h:this.countries,a=0;a<t.length;a++)if(t[a].iso2==n)return t[a];return null},_selectFlag:function(n){if(!n)return!1;this.selectedFlagInner.attr("class","flag "+n);var i=this._getCountryData(n);this.selectedFlagInner.parent().attr("title",i.name);var t=this.countryListItems.children(".flag."+n).first().parent();this.countryListItems.removeClass("active"),t.addClass("active")},_selectListItem:function(n){var i=n.attr("data-country-code");this._selectFlag(i),this._closeDropdown(),this._updateName(i),this.countryInput.trigger("change"),this.countryCodeInput.trigger("change"),this._focus()},_closeDropdown:function(){this.countryList.addClass("hide"),this.selectedFlagInner.children(".arrow").removeClass("up"),n(t).off("keydown"+this.ns),n("html").off("click"+this.ns),this.countryList.off(this.ns)},_scrollTo:function(n){if(n&&n.offset()){var i=this.countryList,t=i.height(),a=i.offset().top,e=a+t,s=n.outerHeight(),r=n.offset().top,o=r+s,u=r-a+i.scrollTop();if(r<a)i.scrollTop(u);else if(o>e){var l=t-s;i.scrollTop(u-l)}}},_updateName:function(n){this.countryCodeInput.val(n).trigger("change"),this.countryInput.val(this._getCountryData(n).name)},handleAutoCountry:function(){"auto"===this.options.initialCountry&&(this.defaultCountry=n.fn[s].autoCountry,this.countryInput.val()||this.selectCountry(this.defaultCountry),this.autoCountryDeferred.resolve())},getSelectedCountryData:function(){var n=this.selectedFlagInner.attr("class").split(" ")[1];return this._getCountryData(n)},selectCountry:function(n){n=n.toLowerCase(),this.selectedFlagInner.hasClass(n)||(this._selectFlag(n),this._updateName(n))},setCountry:function(n){this.countryInput.val(n),this._updateFlagFromInputVal()},destroy:function(){this.countryInput.off(this.ns),this.selectedFlagInner.parent().off(this.ns),this.countryInput.parent().before(this.countryInput).remove()}},n.fn[s]=function(i){var t=arguments;if(i===a||"object"==typeof i)return this.each(function(){n.data(this,"plugin_"+s)||n.data(this,"plugin_"+s,new e(this,i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var r;return this.each(function(){var a=n.data(this,"plugin_"+s);a instanceof e&&"function"==typeof a[i]&&(r=a[i].apply(a,Array.prototype.slice.call(t,1))),"destroy"===i&&n.data(this,"plugin_"+s,null)}),r!==a?r:this}},n.fn[s].getCountryData=function(){return h},n.fn[s].setCountryData=function(n){h=n};var h=n.each([{n:"Australia",i:"au"},{n:"Malaysia",i:"my"},{n:"Singapore",i:"sg"},{n:"India (भारत)",i:"in"}],function(n,i){i.name=i.n,i.iso2=i.i,delete i.n,delete i.i})});